#!/bin/bash
# Lynis Reporter - One Command Install
# Usage: curl -sSL https://raw.githubusercontent.com/saitama142/LYNIS-SECURITY-REPORTER-/main/install | bash

set -e

echo
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘     ğŸ”’  LYNIS REPORTER - INSTALLER               â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo

# Check if already in the repo
if [ -f "lynis-report" ]; then
    DIR="$(pwd)"
    echo "âœ“ Already in lynis-reporter directory"
else
    DIR="$HOME/lynis-reporter"
    if [ -d "$DIR" ]; then
        echo "! Directory exists. Updating..."
        cd "$DIR"
        git pull -q 2>/dev/null || true
    else
        echo "â†’ Cloning repository..."
        git clone https://github.com/saitama142/LYNIS-SECURITY-REPORTER-.git "$DIR" -q
        cd "$DIR"
    fi
fi

echo "â†’ Installing system dependencies..."
sudo apt update -qq
sudo apt install -y lynis python3-pip python3-yaml python3-jinja2 -qq 2>/dev/null

echo "â†’ Installing Python packages..."
pip3 install --user -q plotly pandas paramiko 2>/dev/null || true

echo "â†’ Setting up directories..."
mkdir -p reports data logs

echo "â†’ Making scripts executable..."
chmod +x lynis-report scan report

echo
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘              âœ…  INSTALLATION COMPLETE            â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo
echo "ğŸ“– Quick Commands:"
echo
echo "   ./scan             â†’ Run scan + generate report"
echo "   ./scan quick       â†’ Quick scan (30 seconds)"
echo "   ./report           â†’ Interactive menu"
echo "   ./report generate  â†’ Just generate from existing scan"
echo
echo "ğŸš€ Try it now:"
echo "   cd $DIR"
echo "   ./scan"
echo
